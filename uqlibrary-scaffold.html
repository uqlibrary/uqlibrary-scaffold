<link rel="import" href="../polymer/polymer.html">

<!-- Iron elements -->
<link rel="import" href="../iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-pages/iron-pages.html">
<link rel="import" href="../iron-selector/iron-selector.html">

<link rel="import" href="../iron-media-query/iron-media-query.html">
<link rel="import" href="../iron-icons/communication-icons.html">
<link rel="import" href="../iron-icons/social-icons.html">

<!-- Paper elements -->
<link rel="import" href="../paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../paper-header-panel/paper-header-panel.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-material/paper-material.html">
<link rel="import" href="../paper-menu/paper-menu.html">
<link rel="import" href="../paper-styles/paper-styles-classes.html">
<link rel="import" href="../paper-toast/paper-toast.html">
<link rel="import" href="../paper-toolbar/paper-toolbar.html">

<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-input/paper-input-container.html">


<!--UQ Library elements-->
<link rel="import" href="../uqlibrary-search-input/uqlibrary-search-input.html">
<link rel="import" href="../uqlibrary-menu/uqlibrary-menu.html">

<!--
Reusable scaffold

##### Example

<uqlibrary-scaffold>
  <content> app content goes here ... </content>
</uqlibrary-scaffold>

@element uqlibrary-scaffold
@blurb Reusable scaffold containing common styling and dynamic attributes
@status alpha
@homepage https://github.com/uqlibrary/uqlibrary-scaffold
-->

<dom-module id="uqlibrary-scaffold">
  <style>
    .active {
      background: #fff;
      color: #333;
    }
  </style>
  <template>

    <iron-media-query query="(max-width: 620px)" query-matches="{{isNarrow}}"></iron-media-query>

    <paper-drawer-panel id="scaffoldDrawerPanel" force-narrow>
      <div drawer>
        <uqlibrary-menu
                user="{{user}}"
                menu-file="{{appMenuFile}}"
                on-selected-menu-item-changed="closeMenuDrawer"
                on-menu-items-changed="menuReloaded"
                on-logout-clicked="logout">

        </uqlibrary-menu>
      </div>
      <paper-header-panel main>
        <!-- Main Toolbar -->
        <paper-toolbar id="mainToolbar">

          <paper-icon-button icon="menu" tabindex="1" paper-drawer-toggle hidden$="{{searchIsActive}}"></paper-icon-button>
          <!-- Application name -->
          <div class="appName paper-font-headline" hidden$="{{searchIsActive}}">{{appTitle}}</div>

          <!--Toolbar search-->
          <uqlibrary-search-input class="flex" id="search" is-narrow$="{{isNarrow}}" enable-search-suggestions={{enableSearchSuggestions}}></uqlibrary-search-input>

          <!-- Toolbar icons -->
          <div id="rightScaffold" hidden$="{{searchIsActive}}">
            <paper-icon-button icon="communication:chat-bubble-outline" hidden$="{{isNarrow}}"></paper-icon-button>
            <paper-icon-button icon="apps"></paper-icon-button>
            <paper-icon-button icon="social:notifications-none"></paper-icon-button>
            <paper-icon-button icon="account-circle" hidden$="{{isNarrow}}"></paper-icon-button>
          </div>
        </paper-toolbar>
        <!-- Main Content -->
        <div class="content">
          <content></content>
        </div>
      </paper-header-panel>
    </paper-drawer-panel>

  </template>
  <script>

    Polymer({
      is: 'uqlibrary-scaffold',
      properties: {
        /**
         * TODO: description of these properties
         */
        searchIsActive: {
          type: Boolean,
          value: false,
          notify: true
        },
        enableSearchSuggestions: {
          type: Boolean,
          value: false
        },
        user: Object,
        appTitle: String,
        appMenuFile: Object
      },

      attached: function() {
        this.user = {
          hasSession: false
        };
      },

      menuReloaded: function(e) {
        console.log('menuReloaded');
        console.log(e.detail);
      },

      ready: function() {
        var that = this;
        this.$.search.addEventListener('uqlibrary-search-input-button-clicked-narrow', function(e) {
          console.log('clicked search while narrow!');
          that.searchIsActive = true;
          that.$.mainToolbar.toggleClass('active');
        });
        this.$.search.addEventListener('uqlibrary-search-input-back', function(e) {
          console.log('clicked back while narrow!');
          that.searchIsActive = false;
          that.$.mainToolbar.toggleClass('active');
        });

      },

      closeMenuDrawer: function() {
        this.$.scaffoldDrawerPanel.closeDrawer();
      },

      logout: function() {
        this.$.scaffoldDrawerPanel.closeDrawer();
        //TODO: modal dialogs are not displayed properly in scaffold, dialog size is not calculate correctly inside drawer
        //TODO: show dialog from body
        console.log('perform logout/show dialog');
      }

      });
  </script>
</dom-module>
