<link href="../polymer/polymer.html" rel="import">
<link rel="import" href="../core-scaffold/core-scaffold.html">
<link rel="import" href="../core-header-panel/core-header-panel.html">
<link rel="import" href="../core-menu/core-menu.html">
<link rel="import" href="../core-item/core-item.html">
<link rel="import" href="../core-icon-button/core-icon-button.html">
<link rel="import" href="../core-toolbar/core-toolbar.html">
<link rel="import" href="../core-menu/core-submenu.html">
<link rel="import" href="../uqlibrary-menu/uqlibrary-menu.html">
<link rel="import" href="../uqlibrary-search-input/uqlibrary-search-input.html">
<link rel="import" href="../uqlibrary-apps-button/uqlibrary-apps-button.html">
<link rel="import" href="../uqlibrary-notifications-button/uqlibrary-notifications-button.html">
<link rel="import" href="../uqlibrary-account-button/uqlibrary-account-button.html">

<!--
Reusable scaffold

##### Example

<uqlibrary-scaffold></uqlibrary-scaffold>

@element uqlibrary-scaffold
@blurb Reusable scaffold containing common styling and dynamic attributes
@status alpha
@homepage https://github.com/uqlibrary/uqlibrary-scaffold
-->

<polymer-element name="uqlibrary-scaffold" attributes="appTitle appMenuFile">
  <template>
    <link rel="stylesheet" href="../uqlibrary-elements/resources/theme/element.css">
    <style>
      #coreScaffold /deep/ #drawerPanel #menuButton {
        display: none;
      }
      #coreScaffold /deep/ #drawerPanel core-toolbar {
        background-color: #4a075f;
      }
      #mainToolbar {
        width: 100%;
          white-space: nowrap;
      }
        .hidden {
            opacity: 0;
            visibility: hidden;
        }
        .visible {
            opacity: 1 !important;
            visibility: visible !important;
        }
        .openSearch {
            margin: 0 24px;
            background-color: rgba(255,255,255,0.16);
            border-radius: 2px;
            cursor: text;
        }
      .openSearch:hover {
          background-color: rgba(255,255,255,0.24);
      }
        .turnWhite {
            background-color: #fff;
        }
    </style>
    <core-media-query query="max-width:768px" queryMatches="{{isNarrow}}"></core-media-query>
    <core-scaffold id="coreScaffold" responsiveWidth="{{width}}">
      <core-header-panel mode="seamed" id="coreHeaderPanel" navigation flex>
        <uqlibrary-menu menuFile="{{appMenuFile}}"></uqlibrary-menu>
      </core-header-panel>
      <div tool id="mainToolbar">
        <div horizontal layout>
          <div flex?="{{isNarrow}}" id="scaffoldLeft">
            <core-icon-button icon="menu" class="{{ {hidden: drawerIsOpen, visible: isNarrow} | tokenList }}" on-tap="{{onOpenMenu}}"></core-icon-button>
              {{appTitle}}
          </div>
            <div flex?="{{!isNarrow || searchIsActive}}" class="{{ {openSearch: !isNarrow} | tokenList }}">
                <uqlibrary-search-input placeholderText="Search" narrow="{{isNarrow}}" id="search"></uqlibrary-search-input>
            </div>
            <div hidden?="{{searchIsActive}}" id="scaffoldRight">
                <uqlibrary-apps-button></uqlibrary-apps-button>
                <uqlibrary-notifications-button allowDesktopNotifications></uqlibrary-notifications-button>
                <uqlibrary-account-button hidden?="{{isNarrow}}"></uqlibrary-account-button>
            </div>
        </div>
      </div>
      <div><content></content></div>
    </core-scaffold>
  </template>
  <script>
    Polymer('uqlibrary-scaffold', {
      width: '256px',
      drawerIsOpen: false,
      searchIsActive: false,

      ready: function () {
          that = this;
        this.addEventListener('uqlibrary-menu-close', this.onCloseMenu);
        this.$.coreScaffold.closeDrawer();
        if (! this.isNarrow) {
          this.width = '9999px';
        }
          this.$.search.addEventListener('uqlibrary-search-input-button-clicked', function(e) {
              console.log('clicked search!');
//              that.searchIsActive = true;
          });
          this.$.search.addEventListener('uqlibrary-search-input-button-clicked-narrow', function(e) {
              console.log('clicked search while narrow!');
              that.$.scaffoldLeft.setAttribute('hidden', 'true');
              that.$.scaffoldRight.setAttribute('hidden', 'true');
              that.searchIsActive = true;
          });

          this.$.search.addEventListener('uqlibrary-search-input-back', function(e) {
              console.log('clicked back while narrow!');
              that.$.scaffoldLeft.removeAttribute('hidden');
              that.$.scaffoldRight.removeAttribute('hidden');
              that.searchIsActive = false;
          });
      },

      onOpenMenu: function () {
        if (! this.isNarrow) {
          this.width = '256px';
        }
        this.$.coreScaffold.openDrawer();
        this.drawerIsOpen = true;
      },

      onCloseMenu: function () {
        this.$.coreScaffold.closeDrawer();
        if (! this.isNarrow) {
          this.width = '9999px';
        }
        this.drawerIsOpen = false;
      }
    });
  </script>
</polymer-element>